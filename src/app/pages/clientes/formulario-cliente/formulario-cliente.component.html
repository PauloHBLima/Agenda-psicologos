<mat-card class="form-card">
  <mat-card-title>Cadastro / Edição de Cliente</mat-card-title>

  <form [formGroup]="form" (ngSubmit)="submit()" class="client-form">

    <!-- Dados principais do cliente -->
    <div class="form-section">
      <h3>Informações Pessoais</h3>

      <mat-form-field appearance="outline">
        <mat-label>Nome</mat-label>
        <input matInput formControlName="name" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>CPF</mat-label>
        <input matInput formControlName="cpf" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Data de Nascimento</mat-label>
        <input matInput [matDatepicker]="birthPicker" formControlName="birthDate" />
        <mat-datepicker-toggle matSuffix [for]="birthPicker"></mat-datepicker-toggle>
        <mat-datepicker #birthPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Telefone</mat-label>
        <input matInput formControlName="phoneNumber" />
      </mat-form-field>
    </div>

    <!-- Informações de agendamento -->
    <div class="form-section">
      <h3>Agendamento e Tratamento</h3>

      <mat-form-field appearance="outline">
        <mat-label>Preço da Consulta</mat-label>
        <input matInput type="number" formControlName="appointmentPrice" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Frequência</mat-label>
        <input matInput type="number" formControlName="appointmentFrequency" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Data de Início</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="treatmentStartDate" />
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Data de Término</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="treatmentEndDate" />
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Duração da Sessão (min)</mat-label>
        <input matInput type="number" formControlName="appointmentDurationInMinutes" />
      </mat-form-field>
    </div>

    <!-- Contatos de emergência -->
    <div class="form-section emergency-section">
      <h3>Contatos de Emergência</h3>
      <div formArrayName="emergencyContacts">
        <div *ngFor="let ec of emergencyContacts.controls; let i = index" [formGroupName]="i" class="emergency-contact">

          <mat-form-field appearance="outline">
            <mat-label>Nome</mat-label>
            <input matInput formControlName="name" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Telefone</mat-label>
            <input matInput formControlName="phoneNumber" />
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Parentesco</mat-label>
            <input matInput formControlName="relationship" />
          </mat-form-field>

          <button mat-mini-button color="warn" type="button" (click)="removeEmergencyContact(i)">
            Remover
          </button>
        </div>
      </div>

      <button mat-raised-button color="accent" type="button" (click)="addEmergencyContact()">
        Adicionar Contato de Emergência
      </button>
    </div>

    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="saving">
        {{ clientId ? 'Atualizar' : 'Salvar' }}
      </button>
      <mat-progress-spinner *ngIf="saving" diameter="24" mode="indeterminate"></mat-progress-spinner>
    </div>
  </form>
</mat-card>
